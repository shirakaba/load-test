<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" >
    <head>
        <meta http-equiv="cache-control" content="no-cache" />
        <!--<link rel="stylesheet" type="text/css" href="linkTagCSS.css" />-->
        <script type="text/javascript">
            window.completions = [];

            function reportCompletion(item, task, date){
                console.log(item + " " + task + " at: " + formatDate(date));

                window.completions.push({
                    item: item,
                    task: task,
                    date: date
                })
            }

            function formatDate(date){
                var dateNowStrSliced = date.toString().slice(6);
                return "..." + dateNowStrSliced[0] + "," + dateNowStrSliced.slice(1,4) + "," + dateNowStrSliced.slice(4,7) + " ms";
            }

            window.CACHE_BUST = "?v=" + Date.now();
            // TODO: Do all this (ie. calling initApp()) only once body is ready. This currently may run before body.
            window.semaphore = {
                bundleLoaded: false,
                cssLoaded: false 
            };

            [
                "index.css",
                "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
            ]
            .forEach(
                function(sheetHref){
                    var link = document.createElement('link');
                    link.rel = "stylesheet";
                    link.type = "text/css";
                    link.href = sheetHref + window.CACHE_BUST; // cachebust.

                    // 'load' event on &lt;link&gt; elements support: https://pie.gd/test/script-link-events/
                    window.addEventListener(
                        'load',
                        function(){
                            document.getElementsByTagName('head')[0].appendChild(link);
                            reportCompletion("&lt;link&gt;: " + sheetHref, "loaded", Date.now());
                        }
                    );
                }
            );

            [
                "index.js",
                "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"
            ]
            .forEach(
                function(scriptSrc){
                    var script = document.createElement('script');
                    
                    script.onload = function() {
                        window.semaphore.bundleLoaded = true;
                    };

                    script.type = "text/javascript";
                    script.src = scriptSrc + window.CACHE_BUST;

                    window.addEventListener(
                        'load',
                        function(){
                            document.getElementsByTagName('head')[0].appendChild(script);
                            reportCompletion("&lt;script&gt;: " + scriptSrc, "loaded", Date.now());
                        }
                    );
                }
            );

            console.log("&lt;head&gt;'s &lt;script&gt; finished running at: " + formatDate(Date.now()));
        </script>

        <title>Load test</title>
    </head>

    <body onload="reportCompletion('body.onload()', 'triggered', Date.now());">
        <ol id="theList" style="background-color: lightgray;">
        </ol>
        <img src="giga_cirno.png" onload="reportCompletion('&lt;img&gt;: Giga Cirno', 'loaded', Date.now());"/>
        <script type="text/javascript">
            reportCompletion('&lt;body&gt;\'s inline &lt;script&gt;', 'run', Date.now())
        </script>
        <script type="text/javascript">
            console.log("Running listing task now.");
            var theList = document.getElementById('theList');
            window.completions.forEach(function(completion){
                var ul = document.createElement('ul');
                ul.textContent = completion.item + " " + completion.task + " at: " + formatDate(completion.date);
                theList.appendChild(ul);
            });
        </script>
    </body>

</html>